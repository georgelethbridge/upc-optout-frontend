<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPC Opt-Out Filing</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Google One Tap -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Client libraries used by script.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <!-- Live/Sandbox indicator populated by /mode -->
  <div id="mode-indicator" class="mode-indicator"></div>

  <!-- Sign-in gate -->
  <div id="login-box" class="login-box">
    <h2>Sign in</h2>
    <div id="g_id_onload"
         data-client_id="476871645407-rlheum0kjap2jtq5c1p63e2q6k9kfb5p.apps.googleusercontent.com"
         data-callback="onSignIn"
         data-auto_select="true"></div>
    <div class="g_id_signin" data-type="standard"></div>
  </div>

  <!-- App -->
  <main id="app" class="app" style="display:none">
    <h1>UPC Opt-Out Filing</h1>

    <!-- Initials / role selection (determines statusPersonLodgingApplication) -->
    <section class="panel">
      <label for="initials"><strong>Initials</strong> (maps to stored UPC creds & role)</label>
      <input id="initials" placeholder="e.g., YH or GL" />
    </section>

    <div id="main-layout" class="grid">
      <!-- Spreadsheet upload -->
      <section class="panel">
        <h3>1) Spreadsheet</h3>
        <p>Drop your .xlsx here — we’ll extract EP Publication numbers and first owner details.</p>
        <div id="spreadsheet-drop" class="drop-zone">Drop spreadsheet here</div>
        <input type="file" id="spreadsheet" accept=".xlsx" />
        <div id="ep-list" class="box" style="margin-top:0.5rem"></div>
      </section>

      <!-- Signed Application PDF -->
      <section class="panel">
        <h3>2) Application PDF (signed)</h3>
        <div id="application-drop" class="drop-zone">Drop signed application PDF here</div>
        <input type="file" id="application_pdf" accept="application/pdf" />
        <div id="application-preview" class="pdf-preview" style="margin-top:0.5rem"></div>
      </section>

      <!-- Mandate PDF (only for non-registered reps) -->
      <section id="mandate-preview-box" class="panel hidden">
        <h3>3) Mandate PDF (if required)</h3>
        <div id="mandate-drop" class="drop-zone">Drop mandate PDF here</div>
        <input type="file" id="mandate_pdf" accept="application/pdf" />
        <div id="mandate-preview" class="pdf-preview" style="margin-top:0.5rem"></div>
      </section>

      <!-- Applicant Info -->
      <section class="panel">
        <h3>Applicant Info (from spreadsheet)</h3>
        <div class="box">
          <div class="actions" style="margin-bottom:0.5rem">
            <button id="edit-applicant">Edit</button>
          </div>
          <!-- Compact, readable summary built by script.js -->
          <div id="applicant-summary" class="box"></div>

          <!-- Edit panel (shown when clicking Edit) -->
          <div id="applicant-edit-form" class="edit-form" style="display:none">
            <label>Applicant Type:
              <select id="edit-applicant-type">
                <option value="true">Natural Person</option>
                <option value="false">Legal Entity</option>
              </select>
            </label>

            <label>Name:
              <input id="edit-name" placeholder="Full name (natural) or Company (legal)" />
            </label>

            <div id="name-split-fields" class="row-split hidden">
              <label>First name: <input id="edit-first" /></label>
              <label>Last name: <input id="edit-last" /></label>
            </div>

            <label>Email:
              <input id="edit-email" placeholder="contact@example.com" />
            </label>

            <label>Address line:
              <input id="edit-address" />
            </label>

            <div class="row-split">
              <label>City: <input id="edit-city" /></label>
              <label>ZIP: <input id="edit-zip" /></label>
              <label>State: <input id="edit-state" placeholder="ISO country code if possible" /></label>
            </div>

            <div class="actions">
              <button id="save-applicant">Save</button>
              <button id="cancel-edit">Cancel</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Mandator (only shown when initials are NOT a registered representative) -->
      <section id="mandator-section" class="panel hidden">
        <h3>Mandator (if not Registered Representative)</h3>
        <div class="row-split">
          <label>First name: <input id="mandator-first" /></label>
          <label>Last name: <input id="mandator-last" /></label>
        </div>
        <label>Email: <input id="mandator-email" placeholder="mandator@example.com" /></label>
        <label>Address line: <input id="mandator-address" /></label>
        <div class="row-split">
          <label>City: <input id="mandator-city" /></label>
          <label>ZIP: <input id="mandator-zip" /></label>
          <label>State: <input id="mandator-country" placeholder="ISO country code" /></label>
        </div>
      </section>

      <!-- JSON Preview & Controls -->
      <section class="panel">
        <h3>Preview (request JSON)</h3>
        <button id="toggle-json" class="secondary">▼ Hide / Show</button>
        <div id="json-wrapper" style="margin-top:0.5rem">
          <pre class="preview" id="request-json">{}</pre>
          <button id="copy-request-json" class="secondary" style="margin-top:0.5rem">
            <span class="copy-icon">Copy JSON</span>
            <span class="success-icon" style="display:none;">Copied!</span>
          </button>
        </div>
      </section>
    </div>

    <div id="spinner" class="spinner hidden">Checking address & classifying…</div>

    <div class="actions global">
      <button id="submit" disabled>Submit</button>
    </div>

    <div id="result" style="margin-top:1rem"></div>
  </main>

  <!-- App script -->
  <script src="script.js"></script>
</body>
</html>
